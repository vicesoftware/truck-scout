FROM node:20-alpine AS base
    WORKDIR /app
    ARG TEST_MODE=watch
    ENV TEST_MODE=${TEST_MODE}
    COPY package*.json ./
    RUN npm ci

FROM base AS test-runner
    COPY . .
    CMD ["npm", "run", "test:api:${TEST_MODE}"]
