# Base stage
FROM node:20-alpine AS base
WORKDIR /app

# Copy all files first
COPY . .

# Install all dependencies
RUN npm ci

# Test stage
FROM base AS test
ENV NODE_ENV=test
ENV ENVIRONMENT=test

# Run tests
CMD ["npm", "run", "test"]
